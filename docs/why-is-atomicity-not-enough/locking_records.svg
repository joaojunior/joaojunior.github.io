<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="948" height="863"><desc>title%20Locking%20records%0ATransaction%20A-%3EDatabase%3AStart%20a%20transaction%0ATransaction%20A%3C--Database%3AOk%0ATransaction%20A-%3EDatabase%3Aselect%20amount%20from%20accounts%20where%20id%3D1%20or%20id%3D2%20for%20update%0ATransaction%20A%3C--Database%3Areturn%202%20records%0A%0ATransaction%20B-%3EDatabase%3AStart%20a%20transaction%0ATransaction%20B%3C--Database%3AOk%0ATransaction%20B-%3EDatabase%3Aselect%20amount%20from%20accounts%20where%20id%3D1%20for%20share%0ATransaction%20A-%3EDatabase%3Aupdate%20accounts%20set%20amount%3D0%20where%20id%3D1%0ATransaction%20A%3C--Database%3AOk%0ATransaction%20A-%3EDatabase%3Aupdate%20accounts%20set%20amount%3Damount%2B500%20where%20id%3D2%0ATransaction%20A%3C--Database%3AOk%0ATransaction%20A-%3EDatabase%3ACommit%20and%20finish%20the%20transaction%0ATransaction%20A%3C--Database%3AOk%0ATransaction%20B%3C--Database%3Aamount%3D0%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="948" height="863"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.3675993977174" y="26.3876361" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Locking records</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 103.26361593799999 L 72.83638854296484 863.227535618" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 103.26361593799999 L 502.7540892658815 863.227535618" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 875.19861493997 103.26361593799999 L 875.19861493997 863.227535618" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878700000003 55.765870957999994 L 136.87689838592968 55.765870957999994 L 136.87689838592968 103.26361593799999 L 8.795878700000003 103.26361593799999 L 8.795878700000003 55.765870957999994 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.67185853800001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Transaction A</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 452.2890875405924 55.765870957999994 L 553.2190909911706 55.765870957999994 L 553.2190909911706 103.26361593799999 L 452.2890875405924 103.26361593799999 L 452.2890875405924 55.765870957999994 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="471.3761443195924" y="85.67185853800001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Database</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 811.1581050970051 55.765870957999994 L 939.2391247829348 55.765870957999994 L 939.2391247829348 103.26361593799999 L 811.1581050970051 103.26361593799999 L 811.1581050970051 55.765870957999994 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="830.2451618760051" y="85.67185853800001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Transaction B</text></g></g><g><g><g><rect fill="white" stroke="none" x="225.67189430077082" y="138.44713073799997" width="124.24668920730468" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="228.31065791077083" y="154.279712398" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Start a transaction</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 161.31641535799997 L 488.27020900654816 161.31641535799997" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,161.31641535799997) translate(-502.7540892658815,-161.31641535799997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 488.0942914325481 153.9865164413333 L 502.7540892658815 161.31641535799997 L 488.0942914325481 168.64631427466665 Z"/></g></g><g><g><rect fill="white" stroke="none" x="275.789974439931" y="187.70405145799995" width="24.010528928984375" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.428738049931" y="203.53663311799997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Ok</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 210.57333607799995 L 87.32026880229817 210.57333607799995" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(72.83638854296484,210.57333607799995) translate(-72.83638854296484,-210.57333607799995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 87.49618637629817 203.24343716133328 L 72.83638854296484 210.57333607799995 L 87.49618637629817 217.90323499466663 Z"/></g></g><g><g><rect fill="white" stroke="none" x="93.65330146629817" y="236.96097217799993" width="388.28387487625" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="96.29206507629817" y="252.79355383799995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">select amount from accounts where id=1 or id=2 for update</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 259.83025679799994 L 488.27020900654816 259.83025679799994" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,259.83025679799994) translate(-502.7540892658815,-259.83025679799994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 488.0942914325481 252.50035788133326 L 502.7540892658815 259.83025679799994 L 488.0942914325481 267.1601557146666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="233.41706489403253" y="286.21789289799995" width="108.75634802078125" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="236.05582850403255" y="302.05047455799996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">return 2 records</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 309.0871775179999 L 87.32026880229817 309.0871775179999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(72.83638854296484,309.0871775179999) translate(-72.83638854296484,-309.0871775179999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 87.49618637629817 301.75727860133327 L 72.83638854296484 309.0871775179999 L 87.49618637629817 316.41707643466657 Z"/></g></g><g><g><rect fill="white" stroke="none" x="626.8530074992734" y="335.4748136179999" width="124.24668920730468" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="629.4917711092734" y="351.30739527799994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Start a transaction</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 875.19861493997 358.3440982379999 L 517.2379695252148 358.3440982379999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,358.3440982379999) translate(-502.7540892658815,-358.3440982379999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 517.4138870992148 351.01419932133325 L 502.7540892658815 358.3440982379999 L 517.4138870992148 365.67399715466655 Z"/></g></g><g><g><rect fill="white" stroke="none" x="676.9710876384336" y="384.7317343379999" width="24.010528928984375" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="679.6098512484335" y="400.5643159979999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Ok</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 407.6010189579999 L 860.7147346806366 407.6010189579999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(875.19861493997,407.6010189579999) translate(-875.19861493997,-407.6010189579999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 860.5388171066367 400.27112004133323 L 875.19861493997 407.6010189579999 L 860.5388171066367 414.93091787466653 Z"/></g></g><g><g><rect fill="white" stroke="none" x="523.5710021892148" y="433.9886550579999" width="330.8106998274219" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="526.2097657992148" y="449.8212367179999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">select amount from accounts where id=1 for share</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 875.19861493997 456.85793967799987 L 517.2379695252148 456.85793967799987" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,456.85793967799987) translate(-502.7540892658815,-456.85793967799987)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 517.4138870992148 449.5280407613332 L 502.7540892658815 456.85793967799987 L 517.4138870992148 464.1878385946665 Z"/></g></g><g><g><rect fill="white" stroke="none" x="146.60606025536066" y="483.2455757779999" width="282.378357298125" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="149.24482386536067" y="499.0781574379999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">update accounts set amount=0 where id=1</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 506.11486039799985 L 488.27020900654816 506.11486039799985" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,506.11486039799985) translate(-502.7540892658815,-506.11486039799985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 488.0942914325481 498.7849614813332 L 502.7540892658815 506.11486039799985 L 488.0942914325481 513.4447593146665 Z"/></g></g><g><g><rect fill="white" stroke="none" x="275.789974439931" y="532.5024964979998" width="24.010528928984375" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.428738049931" y="548.3350781579998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Ok</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 555.3717811179998 L 87.32026880229817 555.3717811179998" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(72.83638854296484,555.3717811179998) translate(-72.83638854296484,-555.3717811179998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 87.49618637629817 548.0418822013331 L 72.83638854296484 555.3717811179998 L 87.49618637629817 562.7016800346665 Z"/></g></g><g><g><rect fill="white" stroke="none" x="109.72347663719661" y="581.7594172179998" width="356.14352453445315" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.36224024719661" y="597.5919988779998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">update accounts set amount=amount+500 where id=2</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 604.6287018379999 L 488.27020900654816 604.6287018379999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,604.6287018379999) translate(-502.7540892658815,-604.6287018379999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 488.0942914325481 597.2988029213332 L 502.7540892658815 604.6287018379999 L 488.0942914325481 611.9586007546666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="275.789974439931" y="631.0163379379999" width="24.010528928984375" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.428738049931" y="646.8489195979998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Ok</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 653.8856225579999 L 87.32026880229817 653.8856225579999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(72.83638854296484,653.8856225579999) translate(-72.83638854296484,-653.8856225579999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 87.49618637629817 646.5557236413332 L 72.83638854296484 653.8856225579999 L 87.49618637629817 661.2155214746666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="176.37698768455988" y="680.2732586579999" width="222.83650243972656" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="179.0157512945599" y="696.1058403179999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Commit and finish the transaction</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 72.83638854296484 703.142543278 L 488.27020900654816 703.142543278" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(502.7540892658815,703.142543278) translate(-502.7540892658815,-703.142543278)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 488.0942914325481 695.8126443613332 L 502.7540892658815 703.142543278 L 488.0942914325481 710.4724421946667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="275.789974439931" y="729.530179378" width="24.010528928984375" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.428738049931" y="745.3627610379999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Ok</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 752.399463998 L 87.32026880229817 752.399463998" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(72.83638854296484,752.399463998) translate(-72.83638854296484,-752.399463998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 87.49618637629817 745.0695650813333 L 72.83638854296484 752.399463998 L 87.49618637629817 759.7293629146667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="653.5315811076719" y="778.787100098" width="70.88954199050781" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="656.1703447176718" y="794.619681758" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">amount=0</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 502.7540892658815 801.656384718 L 860.7147346806366 801.656384718" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(875.19861493997,801.656384718) translate(-875.19861493997,-801.656384718)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 860.5388171066367 794.3264858013333 L 875.19861493997 801.656384718 L 860.5388171066367 808.9862836346667 Z"/></g></g></g><g/><g/><g/></g></svg>